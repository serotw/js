!function(u){"use strict";if("function"!==t(u))return console.error("Can't use jQuery!");function t(e){return e&&typeof e}function i(e){return e&&"object"===t(e)&&"jquery"in e&&e.length}function o(e){return r(e)&&(e instanceof Element||e instanceof HTMLElement)}function n(e){return function(e){return"string"===t(e)}(e)&&""!==e.trim()}function s(e){return function(e){return r(e)&&e instanceof Array}(e)&&e.length}function r(e){return"object"==typeof e&&null!=e}function c(e){return r(e)&&Object&&Object.keys(e).length}function a(e){return"function"===t(e)}function l(e,t){return n(e)&&c(t)&&e in t}function p(){return new p.fn._packs._init(arguments[0],arguments[1],arguments[2])}p.fn=p.prototype={_packs:{_options:{selector:"*[data-viewer-title]",ratioRange:.29411764705882354},_self:function(){return arguments[0]&&arguments[0]===p.fn?arguments[0]:p.fn},_setOptions:function(){const t=p.fn._packs._self(this),n=t._packs;if(c(this)){const r=["selector","ratioRange","container","element","updated","done","complete"];Object.keys(this).forEach(e=>{-1!==r.indexOf(e)&&("root"===e?n._setContainer.call(this[e]):"element"===e?n._setElement.call(this[e]):"updated"===e?n._setUpdated.call(this[e]):-1!==["done","complete"].indexOf(e)?n._setCallback.call(this[e]):u.extend(t.options,{[e]:this[e]}))})}return t},_setContainer:function(){var e=p.fn._packs._self(this);e._packs;return o(this)&&(e.container=this),e},_setElement:function(){var e=p.fn._packs._self(this);e._packs;return o(this)&&(e.element=this),e},_setUpdated:function(){var e=p.fn._packs._self(this);e._packs;return a(this)&&(e.updated=this),e},_setCallback:function(){var e=p.fn._packs._self(this);e._packs;return a(this)&&(e.callback=this),e},_plusTop:function(){p.fn._packs._self(this)._packs;return Math.ceil(window.innerHeight/100*25)},_scrollTop:function(){var e=p.fn._packs._self(this);e._packs;return e.container.scrollTop||document.documentElement.scrollTop},_updated:function(){const n=p.fn._packs._self(this),f=n._packs;if(o(n.element)){const r=e=>{u(n.element).text(e)};let e=n.living||null,t="";s(e)?u.when(function(){if(1!==e.length){let a={},l=-1;u.when(u(e).each((e,t)=>{f._plusTop();var n=f._scrollTop(),r=n+window.innerHeight,s=t.offsetTop,i=t.offsetHeight,o=s+i;let c=0;(c=n>=t.offsetTop?o-n:r<=o?r-s:i)>l&&(l=c),a[c]=t})).then(()=>{e=u(e).filter((e,t)=>{if(t===a[l])return t})})}}()).then(()=>{1===e.length&&(t=u(e[0]).attr("data-viewer-title")),r(t)}):r(t)}return n},_createobViewer:function(){const a=p.fn._packs._self(this),t=a._packs;if(s(a.targets))if(o(a.element)){var e=a.options;const n={living:null,listen:[],previous:{visibleEntryTop:0,parentScrollTop:0}};u.extend(a,n),a.targets.forEach((e,t)=>{n.listen[t]=null}),a.obViewer=new IntersectionObserver(e=>{const s=()=>{!function(e){return null==e}(a.cache)&&clearTimeout(a.cache),a.living=u.map(a.listen,(e,t)=>{if(!0===e)return a.targets[t]}),a.cache=setTimeout(a.updated,1)},i=e=>{a.previous.visibleEntryTop=e.offsetTop,s()},o=t._scrollTop(),c=o>=a.previous.parentScrollTop;a.previous.parentScrollTop=o,e.forEach(e=>{var{target:e,isIntersecting:t}=e,n=u(e),r=u(a.targets).index(e);(a.listen[r]=t)?(n.addClass("active"),r=e.offsetTop>=a.previous.visibleEntryTop,c&&r?(i(e),o):c||r||i(e)):(n.removeClass("active"),s())})},{threshold:[.1,e.ratioRange,1]}),a.targets.forEach(e=>{a.obViewer.observe(e)})}else console.error("Create obViewer: not find element.");else console.error("Create obViewer: not find targets.");return t._end()},_start:function(){var e=p.fn._packs._self(this),t=e._packs,n=e.options||null;return c(n)?(i(n=u(e.container).find(n.selector))&&(e.targets=u.map(n,e=>e)),o(e.element)||i(n=u("#viewer"))&&(e.element=n[0]),t._createobViewer()):t._end()},_end:function(){var e=p.fn._packs._self(this);e._packs;return a(e.callback)&&e.callback(),e},_init:function(){const r=p.fn._packs._self(this),s=r._packs;var e=arguments;return u.each(["options","container","element","updated","callback"],function(e,t){var n="_"+t;!l(t,r)&&l(n,s)&&(r[t]=s[n])}),n(e[0])||o(e[0])||i(e[0])?(n(e[0])&&(e[0]=u(e[0])),i(e[0])&&(e[0]=e[0][0]),o(e[0])&&s._setContainer.call(e[0])):c(e[0])?s._setOptions.call(e[0]):u.isFunction(e[0])&&s._setCallback.call(e[0]),c(e[1])?s._setOptions.call(e[1]):u.isFunction(e[1])&&s._setCallback.call(e[1]),u.isFunction(e[2])&&s._setCallback.call(e[2]),s._start()}}},u.extend(u,{obViewer:p})}(jQuery,window);