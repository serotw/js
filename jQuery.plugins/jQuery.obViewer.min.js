!function(p){"use strict";if("function"!==t(p))return console.error("Can't use jQuery!");function t(e){return e&&typeof e}function i(e){return e&&"object"===t(e)&&"jquery"in e&&e.length}function s(e){return o(e)&&(e instanceof Element||e instanceof HTMLElement)}function n(e){return function(e){return"string"===t(e)}(e)&&""!==e.trim()}function r(e){return function(e){return o(e)&&e instanceof Array}(e)&&e.length}function o(e){return"object"==typeof e&&null!=e}function c(e){return o(e)&&Object&&Object.keys(e).length}function a(e){return"function"===t(e)}function l(e,t){return n(e)&&c(t)&&e in t}function _(){return new _.fn._packs._init(arguments[0],arguments[1],arguments[2])}_.fn=_.prototype={_packs:{_options:{selector:"*[data-viewer-title]",ratioRange:.29411764705882354},_self:function(){return arguments[0]&&arguments[0]===_.fn?arguments[0]:_.fn},_setOptions:function(){const t=_.fn._packs._self(this),n=t._packs;if(c(this)){const r=["selector","ratioRange","container","element","updated","done","complete"];Object.keys(this).forEach(e=>{-1!==r.indexOf(e)&&("root"===e?n._setContainer.call(this[e]):"element"===e?n._setElement.call(this[e]):"updated"===e?n._setUpdated.call(this[e]):-1!==["done","complete"].indexOf(e)?n._setCallback.call(this[e]):p.extend(t.options,{[e]:this[e]}))})}return t},_setContainer:function(){var e=_.fn._packs._self(this);e._packs;return s(this)&&(e.container=this),e},_setElement:function(){var e=_.fn._packs._self(this);e._packs;return s(this)&&(e.element=this),e},_setUpdated:function(){var e=_.fn._packs._self(this);e._packs;return a(this)&&(e.updated=this),e},_setCallback:function(){var e=_.fn._packs._self(this);e._packs;return a(this)&&(e.callback=this),e},_plusTop:function(){_.fn._packs._self(this)._packs;return Math.ceil(window.innerHeight/100*25)},_scrollTop:function(){var e=_.fn._packs._self(this);e._packs;return e.container.scrollTop||document.documentElement.scrollTop},_updated:function(){const f=_.fn._packs._self(this),u=f._packs;if(s(f.element)){const n=e=>{p(f.element).text(e)};let e=f.living||null,t="";r(e)?p.when(function(){if(1!==e.length){let a={},l=-1;p.when(p(e).each((e,t)=>{u._plusTop();let n=u._scrollTop();f.container!==document.documentElement&&f.container!==document.body&&f.container.offsetTop&&(n+=f.container.offsetTop);var r=n+window.innerHeight,o=t.offsetTop,i=t.offsetHeight,s=o+i;let c=0;(c=n>=t.offsetTop?s-n:r<=s?r-o:i)>l&&(l=c),a[c]=t})).then(()=>{e=p(e).filter((e,t)=>{if(t===a[l])return t})})}}()).then(()=>{1===e.length&&(t=p(e[0]).attr("data-viewer-title")),n(t)}):n(t)}return f},_createobViewer:function(){const a=_.fn._packs._self(this),t=a._packs;if(r(a.targets))if(s(a.element)){var e=a.options;const n={living:null,listen:[],previous:{visibleEntryTop:0,parentScrollTop:0}};p.extend(a,n),a.targets.forEach((e,t)=>{n.listen[t]=null}),a.obViewer=new IntersectionObserver(e=>{const o=()=>{!function(e){return null==e}(a.cache)&&clearTimeout(a.cache),a.living=p.map(a.listen,(e,t)=>{if(!0===e)return a.targets[t]}),a.cache=setTimeout(a.updated,1)},i=e=>{a.previous.visibleEntryTop=e.offsetTop,o()},s=t._scrollTop(),c=s>=a.previous.parentScrollTop;a.previous.parentScrollTop=s,e.forEach(e=>{var{target:e,isIntersecting:t}=e,n=p(e),r=p(a.targets).index(e);(a.listen[r]=t)?(n.addClass("active"),r=e.offsetTop>=a.previous.visibleEntryTop,c&&r?(i(e),s):c||r||i(e)):(n.removeClass("active"),o())})},{threshold:[.1,e.ratioRange,1]}),a.targets.forEach(e=>{a.obViewer.observe(e)})}else console.error("Create obViewer: not find element.");else console.error("Create obViewer: not find targets.");return t._end()},_start:function(){var e=_.fn._packs._self(this),t=e._packs,n=e.options||null;return c(n)?(i(n=p(e.container).find(n.selector))&&(e.targets=p.map(n,e=>e)),s(e.element)||i(n=p("#viewer"))&&(e.element=n[0]),t._createobViewer()):t._end()},_end:function(){var e=_.fn._packs._self(this);e._packs;return a(e.callback)&&e.callback(),e},_init:function(){const r=_.fn._packs._self(this),o=r._packs;var e=arguments;return p.each(["options","container","element","updated","callback"],function(e,t){var n="_"+t;!l(t,r)&&l(n,o)&&(r[t]=o[n])}),n(e[0])||s(e[0])||i(e[0])?(n(e[0])&&(e[0]=p(e[0])),i(e[0])&&(e[0]=e[0][0]),s(e[0])&&o._setContainer.call(e[0])):c(e[0])?o._setOptions.call(e[0]):p.isFunction(e[0])&&o._setCallback.call(e[0]),c(e[1])?o._setOptions.call(e[1]):p.isFunction(e[1])&&o._setCallback.call(e[1]),p.isFunction(e[2])&&o._setCallback.call(e[2]),o._start()}}},p.extend(p,{obViewer:_})}(jQuery,window);